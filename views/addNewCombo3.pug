doctype html
html
	head
		script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js')
		link(rel='stylesheet', href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css')
		script(src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js')
		link(href='https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css', rel='stylesheet')
		script(src='https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js')
		title
		link(rel='stylesheet', href='/stylesheets/style.css')
		style(type='text/css').
			.list {
				font-family:sans-serif;
				margin:0;
				padding:20px 0 0;
			}
			.list > li {
				display:block;
				background-color: #eee;
				padding:10px;
				box-shadow: inset 0 1px 0 #fff;
			}
			.avatar {
				max-width: 150px;
			}
			img {
				max-width: 100%;
			}
			h3 {
				font-size: 16px;
				margin:0 0 0.3rem;
				font-weight: normal;
				font-weight:bold;
			}
			p {
				margin-bottom:10px;
			}
			input {
				border:solid 1px #ccc;
				border-radius: 5px;
				padding:7px 14px;
				margin-bottom:5px
			}
			input:focus {
				outline:none;
				border-color:#aaa;
			}
			.preview{
				background-color: grey;
				width: 220px;
				height:305px;
				float: right;
				display: inline;
				border-radius:10px;
				box-shadow: 2px 2px 0px 1px black;
				margin-right: 500px;
				margin-top:-75px;
			}
			.addCard{
				margin-left: 20px;
				display: inline;
			}
			.select2-container{
				margin-bottom:5px;
			}
	body
		h1 Add a new Card to the DataBase
		.preview
			img#targetImage
		form(action='/', method='post')
			p Combo name: 
			input(type='text', value='comboName')
			br
			p Type of combo: 
			select.typeOfComboSelection(name='typeOfCombo')
				option infinite mana
				option infinite damage
				option draw library
				option lethal damage
				option storm
				option graveyard
			br
			p Add card:
			select.cardsSelection(name='state',id="id0")
				- for (var i=0; i< numeroCartas; i++) {
				option(name=locals.cards[i]["name"]) #{locals.cards[i]["name"]}
				- }
			br
			br
			input(type='submit' , value="Enviar nuevo combo")
			input.addCard(type='button', value='+')
		Script().
			var numCards = 0;
			$(document).ready(function() {
				$('#id0').select2({minimumInputLength: 2});
				$('.typeOfComboSelection').select2();
				$('.cardsSelection').on('select2:select', function(e){
					var name = e.params.data["text"];
					$.get(window.location.href,"getPicture:"+name,updatePicture,"text");
				});
				/*
				$('.cardsSelection').on('change', function (e) {
					var name = $('.cardsSelection').find(':selected')[0].value;
					$.get(window.location.href,"getPicture:"+name,updatePicture,"text");
				});
				*/
				function updatePicture(response){
					$("#targetImage").attr("src",response);
				}
				$('.addCard').on('click',function(){
					if(numCards <7){
						$.get(window.location.href,"addCard",addCard,"text")
					}
					else{
						alert("only 8 cards per combo please");
					}
				})
				function addCard(response){
					numCards++;
					var $select = $("<select>").html(response);
					$select.attr("id","id"+numCards).attr("class","cardsSelection")
					var c = numCards -1;
					$("#id"+c).after("<br>").after($select)
					$("#id"+numCards).select2({minimumInputLength: 2}).on('select2:select', function(e){
						var name = e.params.data["text"];
						$.get(window.location.href,"getPicture:"+name,updatePicture,"text");
				});
				}
			});